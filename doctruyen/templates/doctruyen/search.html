{% extends 'base.html' %}
{% load static %}

{% block title %}T√¨m ki·∫øm: {{ query }}{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/search.css' %}">
{% endblock %}

{% block content %}
<div class="search-container container-layout">
    <div class="search-header">
        <h1 class="search-title">
            {% if query %}
                K·∫øt qu·∫£ t√¨m ki·∫øm: "{{ query }}"
            {% else %}
                T√¨m ki·∫øm truy·ªán
            {% endif %}
        </h1>
        <p class="search-result-count">{{ count }} truy·ªán ƒë∆∞·ª£c t√¨m th·∫•y</p>
    </div>

    <div class="search-layout">
        <!-- Filter Sidebar -->
        <div class="search-filter">
            <form method="get" id="filterForm">
                <input type="hidden" name="q" value="{{ query }}">

                <!-- T√°c gi·∫£ -->
                <div class="filter-section">
                    <div class="filter-title">T√°c gi·∫£</div>
                    <input type="text" name="tac_gia" value="{{ tac_gia_filter }}" placeholder="Nh·∫≠p t√™n t√°c gi·∫£..." class="filter-input">
                </div>

                <!-- T√¨nh tr·∫°ng -->
                <div class="filter-section">
                    <div class="filter-title">T√¨nh tr·∫°ng</div>
                    <select name="trang_thai" class="filter-select">
                        <option value="">T·∫•t c·∫£</option>
                        <option value="dang_ra" {% if trang_thai_filter == 'dang_ra' %}selected{% endif %}>ƒêang ra</option>
                        <option value="hoan_thanh" {% if trang_thai_filter == 'hoan_thanh' %}selected{% endif %}>Ho√†n th√†nh</option>
                        <option value="tam_ngung" {% if trang_thai_filter == 'tam_ngung' %}selected{% endif %}>T·∫°m ng∆∞ng</option>
                    </select>
                </div>

                <!-- Th·ªÉ lo·∫°i -->
                <div class="filter-section">
                    <div class="filter-title">Th·ªÉ lo·∫°i</div>
                    <div class="filter-group">
                        {% for genre in all_genres %}
                        <div class="filter-item">
                            <input type="checkbox" id="genre_{{ genre.id }}" name="genres" value="{{ genre.slug }}" 
                                {% if genre.slug in genres_filter %}checked{% endif %}>
                            <label for="genre_{{ genre.id }}">{{ genre.name }}</label>
                        </div>
                        {% endfor %}
                    </div>
                </div>

                <!-- Actions -->
                <div class="filter-actions">
                    <button type="submit" class="btn-filter search">L·ªçc</button>
                    <a href="{% url 'search' %}?q={{ query }}" class="btn-filter reset">X√≥a b·ªô l·ªçc</a>
                </div>
            </form>
        </div>

        <!-- Results -->
        <div>
            {% if truyens %}
                <div class="search-results">
                    {% for truyen in truyens %}
                    <a href="{% url 'truyen-detail' truyen.slug %}" class="story-card">
                        <div class="story-cover">
                            <img src="{% if truyen.anh %}{{ truyen.get_anh_url }}{% else %}{% static 'img/cover_default.jpg' %}{% endif %}" alt="{{ truyen.ten }}">
                        </div>
                        <div class="story-info">
                            <div class="story-title" title="{{ truyen.ten }}">{{ truyen.ten }}</div>
                            <div class="story-author">{{ truyen.tac_gia }}</div>
                        </div>
                    </a>
                    {% endfor %}
                </div>
            {% else %}
                <div class="empty-state">
                    <div class="empty-icon">üîç</div>
                    {% if query %}
                        <p class="empty-text">Kh√¥ng t√¨m th·∫•y truy·ªán n√†o</p>
                        <p class="empty-hint">H√£y th·ª≠ t√¨m ki·∫øm v·ªõi t·ª´ kh√≥a kh√°c</p>
                    {% else %}
                        <p class="empty-text">Vui l√≤ng nh·∫≠p t·ª´ kh√≥a ƒë·ªÉ t√¨m ki·∫øm</p>
                    {% endif %}
                </div>
            {% endif %}
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script src="{% static 'js/search.js' %}"></script>
{% endblock %}
