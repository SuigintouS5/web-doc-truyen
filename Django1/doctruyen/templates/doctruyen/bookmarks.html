{% extends 'base.html' %}
{% load static %}

{% block title %}ƒê√°nh d·∫•u - Theo d√µi - Th√¥ng b√°o{% endblock %}

{% block extra_css %}
<style>
.bookmarks-container {
    margin-top: 30px;
    margin-bottom: 50px;
}

.bookmarks-header {
    margin-bottom: 30px;
}

.bookmarks-header h1 {
    font-size: 28px;
    font-weight: 700;
}

/* Tabs */
.tabs-nav {
    display: flex;
    gap: 0;
    border-bottom: 2px solid #e5e7eb;
    margin-bottom: 30px;
}

.tab-link {
    padding: 12px 20px;
    border: none;
    background: transparent;
    cursor: pointer;
    font-size: 14px;
    font-weight: 600;
    color: #666;
    border-bottom: 2px solid transparent;
    transition: all 0.2s;
}

.tab-link:hover {
    color: #111;
}

.tab-link.active {
    color: #111;
    border-bottom-color: #111;
}

.tab-content {
    display: none;
}

.tab-content.active {
    display: block;
}

/* Story Grid */
.story-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
    gap: 20px;
}

.story-card {
    text-decoration: none;
    color: inherit;
    border-radius: 8px;
    overflow: hidden;
    background: #fff;
    box-shadow: 0 2px 8px rgba(0,0,0,0.08);
    transition: transform 0.2s, box-shadow 0.2s;
}

.story-card:hover {
    transform: translateY(-4px);
    box-shadow: 0 4px 12px rgba(0,0,0,0.12);
}

.story-cover {
    aspect-ratio: 2/3;
    overflow: hidden;
    background: #ddd;
}

.story-cover img {
    width: 100%;
    height: 100%;
    object-fit: cover;
}

.story-info {
    padding: 12px;
}

.story-info h3 {
    font-size: 14px;
    font-weight: 600;
    margin-bottom: 4px;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
}

.story-info p {
    font-size: 12px;
    color: #666;
}

/* Bookmarks List */
.bookmarks-list {
    display: flex;
    flex-direction: column;
    gap: 12px;
}

.bookmark-item {
    padding: 12px;
    border: 1px solid #e5e7eb;
    border-radius: 8px;
    display: flex;
    gap: 16px;
    background: #fff;
}

.bookmark-cover {
    width: 60px;
    height: 90px;
    flex-shrink: 0;
    border-radius: 4px;
    overflow: hidden;
    background: #ddd;
}

.bookmark-cover img {
    width: 100%;
    height: 100%;
    object-fit: cover;
}

.bookmark-info {
    flex: 1;
}

.bookmark-title {
    font-size: 14px;
    font-weight: 600;
    margin-bottom: 4px;
    color: #111;
}

.bookmark-chapter {
    font-size: 12px;
    color: #666;
    margin-bottom: 8px;
}

.bookmark-link {
    display: inline-block;
    padding: 6px 12px;
    background: #111;
    color: #fff;
    border-radius: 4px;
    text-decoration: none;
    font-size: 12px;
    font-weight: 600;
    transition: all 0.2s;
}

.bookmark-link:hover {
    background: #2a2a2a;
}

/* Notifications */
.notifications-list {
    display: flex;
    flex-direction: column;
    gap: 12px;
}

.notification-item {
    padding: 12px;
    border: 1px solid #e5e7eb;
    border-radius: 8px;
    background: #fff;
    transition: all 0.2s;
}

.notification-item.unread {
    background: #f0f8ff;
    border-color: #b3d9ff;
}

.notification-content {
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.notification-text {
    flex: 1;
}

.notification-text strong {
    color: #111;
}

.notification-time {
    font-size: 12px;
    color: #999;
}

.notification-badge {
    display: inline-block;
    width: 10px;
    height: 10px;
    background: #ef4444;
    border-radius: 50%;
    margin-right: 8px;
}

.notification-link {
    display: inline-block;
    padding: 6px 12px;
    background: #111;
    color: #fff;
    border-radius: 4px;
    text-decoration: none;
    font-size: 12px;
    margin-left: 12px;
}

/* Empty State */
.empty-state {
    text-align: center;
    padding: 40px 20px;
    color: #999;
}

.empty-state-icon {
    font-size: 48px;
    margin-bottom: 16px;
}

.empty-state p {
    font-size: 14px;
}

/* Responsive */
@media (max-width: 768px) {
    .story-grid {
        grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
    }

    .tabs-nav {
        flex-wrap: wrap;
    }

    .tab-link {
        padding: 10px 16px;
    }
}
</style>
{% endblock %}

{% block content %}
<div class="bookmarks-container container-layout">
    <div class="bookmarks-header">
        <h1>ƒê√°nh d·∫•u & Theo d√µi</h1>
    </div>

    <!-- TABS -->
    <div class="tabs-nav">
        <button class="tab-link active" data-tab="follows">üìö Truy·ªán theo d√µi ({{ truyen_follows|length }})</button>
        <button class="tab-link" data-tab="bookmarks">üîñ Ch∆∞∆°ng ƒë√£ l∆∞u ({{ bookmarks|length }})</button>
        <button class="tab-link" data-tab="notifications">üîî Th√¥ng b√°o ({{ notifications|length }})</button>
    </div>

    <!-- TAB 1: TRUY·ªÜN THEO D√ïI -->
    <div id="follows" class="tab-content active">
        {% if truyen_follows %}
            <div class="story-grid">
                {% for truyen in truyen_follows %}
                <a href="{% url 'truyen-detail' truyen.slug %}" class="story-card">
                    <div class="story-cover">
                        <img src="{% if truyen.anh %}{{ truyen.get_anh_url }}{% else %}{% static 'img/cover_default.jpg' %}{% endif %}" alt="{{ truyen.ten }}">
                    </div>
                    <div class="story-info">
                        <h3>{{ truyen.ten }}</h3>
                        <p>{{ truyen.tac_gia }}</p>
                    </div>
                </a>
                {% endfor %}
            </div>
        {% else %}
            <div class="empty-state">
                <div class="empty-state-icon">üìö</div>
                <p>B·∫°n ch∆∞a theo d√µi truy·ªán n√†o</p>
                <p style="font-size: 12px; margin-top: 8px;">Nh·∫•p v√†o n√∫t "Theo d√µi" tr√™n trang truy·ªán ƒë·ªÉ th√™m</p>
            </div>
        {% endif %}
    </div>

    <!-- TAB 2: BOOKMARK CH∆Ø∆†NG -->
    <div id="bookmarks" class="tab-content">
        {% if bookmarks %}
            <div class="bookmarks-list">
                {% for bookmark in bookmarks %}
                <div class="bookmark-item">
                    <div class="bookmark-cover">
                        <img src="{% if bookmark.chuong.volume.truyen.anh %}{{ bookmark.chuong.volume.truyen.get_anh_url }}{% else %}{% static 'img/cover_default.jpg' %}{% endif %}" alt="">
                    </div>
                    <div class="bookmark-info">
                        <div class="bookmark-title">{{ bookmark.chuong.volume.truyen.ten }}</div>
                        <div class="bookmark-chapter">
                            Vol {{ bookmark.chuong.volume.so_volume }} - Ch∆∞∆°ng {{ bookmark.chuong.so_chuong }}: {{ bookmark.chuong.ten }}
                        </div>
                        <a href="{% url 'chuong-detail' bookmark.chuong.volume.truyen.slug bookmark.chuong.slug %}" class="bookmark-link">ƒê·ªçc ti·∫øp ‚Üí</a>
                    </div>
                </div>
                {% endfor %}
            </div>
        {% else %}
            <div class="empty-state">
                <div class="empty-state-icon">üîñ</div>
                <p>B·∫°n ch∆∞a l∆∞u ch∆∞∆°ng n√†o</p>
                <p style="font-size: 12px; margin-top: 8px;">Nh·∫•p v√†o icon üîñ khi ƒëang ƒë·ªçc ƒë·ªÉ l∆∞u</p>
            </div>
        {% endif %}
    </div>

    <!-- TAB 3: TH√îNG B√ÅO -->
    <div id="notifications" class="tab-content">
        {% if notifications %}
            <div class="notifications-list">
                {% for notif in notifications %}
                <div class="notification-item {% if not notif.da_doc %}unread{% endif %}">
                    <div class="notification-content">
                        <div class="notification-text">
                            {% if not notif.da_doc %}
                                <span class="notification-badge"></span>
                            {% endif %}
                            {{ notif.noi_dung }}
                        </div>
                        <span class="notification-time">{{ notif.ngay_tao }}</span>
                    </div>
                    {% if notif.truyen %}
                    <a href="{% url 'truyen-detail' notif.truyen.slug %}" class="notification-link">Xem ‚Üí</a>
                    {% endif %}
                </div>
                {% endfor %}
            </div>
        {% else %}
            <div class="empty-state">
                <div class="empty-state-icon">üîî</div>
                <p>B·∫°n kh√¥ng c√≥ th√¥ng b√°o n√†o</p>
            </div>
        {% endif %}
    </div>
</div>

<script>
// Tab switching
document.querySelectorAll('.tab-link').forEach(link => {
    link.addEventListener('click', function() {
        const tabName = this.dataset.tab;
        
        // Hide all tabs
        document.querySelectorAll('.tab-content').forEach(el => {
            el.classList.remove('active');
        });
        
        // Remove active from all links
        document.querySelectorAll('.tab-link').forEach(el => {
            el.classList.remove('active');
        });
        
        // Show selected tab
        document.getElementById(tabName).classList.add('active');
        this.classList.add('active');
    });
});
</script>
{% endblock %}
